C51 COMPILER V9.60.7.0   BATTERY                                                           11/10/2025 17:35:04 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE BATTERY
OBJECT MODULE PLACED IN .\Objects\Battery.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE Driver\Battery.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Lib;.\Driver;.\
                    -User) DEBUG OBJECTEXTEND PRINT(.\Listings\Battery.lst) OBJECT(.\Objects\Battery.obj)

line level    source

   1          #include "Battery.h"
   2          #include "ADC.h"
   3          #include "NVIC.h"
   4          #include "GPIO.h"
   5          
   6          static void GPIO_config(void) {
   7   1          
   8   1          // P13 高阻输入(或准双向)
   9   1          P1_MODE_IN_HIZ(GPIO_Pin_3);
  10   1          
  11   1      }
  12          /******************* AD配置函数 *******************/
  13          static void     ADC_config(void)
  14          {
  15   1              ADC_InitTypeDef         ADC_InitStructure;              //结构定义
  16   1      
  17   1              ADC_InitStructure.ADC_SMPduty   = 31;           //ADC 模拟信号采样时间控制, 0~31（注意： SMPDUTY 一定不能设置小于 
             -10）
  18   1              ADC_InitStructure.ADC_CsSetup   = 0;            //ADC 通道选择时间控制 0(默认),1
  19   1              ADC_InitStructure.ADC_CsHold    = 1;            //ADC 通道选择保持时间控制 0,1(默认),2,3
  20   1              ADC_InitStructure.ADC_Speed     = ADC_SPEED_2X1T;               //设置 ADC 工作时钟频率 ADC_SPEED_2X1T~ADC_SPEED_2X16T
  21   1              ADC_InitStructure.ADC_AdjResult = ADC_RIGHT_JUSTIFIED;  //ADC结果调整,  ADC_LEFT_JUSTIFIED,ADC_RIGHT_JUSTIF
             -IED
  22   1              ADC_Inilize(&ADC_InitStructure);                //初始化
  23   1              ADC_PowerControl(ENABLE);                               //ADC电源开关, ENABLE或DISABLE
  24   1              NVIC_ADC_Init(DISABLE,Priority_0);              //中断使能, ENABLE/DISABLE; 优先级(低到高) Priority_0,Priority_1,Prio
             -rity_2,Priority_3
  25   1      }
  26          
  27          
  28          void Battery_init(){
  29   1          GPIO_config();
  30   1          ADC_config();
  31   1      }
  32          
  33          float Battery_get_voltage(){
  34   1          u16 adc_value = 0;
  35   1          float Vadc = 0, Vbat = 0;
  36   1          adc_value = Get_ADCResult(ADC_CH3); // chn: ADC_CH0, ADC_CH1...ADC_CH15
  37   1          // 将ADC数值转成电压 Vadc / 2.5V = adc_value / 4096
  38   1          Vadc = adc_value * 2.5f / 4096;
  39   1          
  40   1          // 根据电阻比例计算电池电压
  41   1      //    Vbat = Vadc * (51 + 10) / 10;
  42   1          Vbat = Vadc * 6.1f;
  43   1          
  44   1          // 2.5V / 10 = Vbat / (51 + 10)
  45   1          // Vbat = 2.5 * 61 / 10 = 15.25V
  46   1          // Vbat = 2.5 * 6.1 = 15.25V
  47   1          
  48   1          return Vbat;
  49   1      }


C51 COMPILER V9.60.7.0   BATTERY                                                           11/10/2025 17:35:04 PAGE 2   

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    139    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       9
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
